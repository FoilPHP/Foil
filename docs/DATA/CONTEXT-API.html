<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Giuseppe Mazzapica">
    <title>Data / Context API. Foil: PHP Template Engine</title>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300|Source+Code+Pro:400' rel='stylesheet' type='text/css'>
    <link href="http://www.foilphp.it/css/theme.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

      <!-- Sidebar -->
      <div id="sidebar-wrapper">
          <ul class="sidebar-nav">
                                                  <li>
                      <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i> Getting Started</a>
                      <ul>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/GETTING-STARTED/INSTALLATION.html">
                                      Installation
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/GETTING-STARTED/ENGINE.html">
                                      Engine
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/GETTING-STARTED/FOLDERS.html">
                                      Folders
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/GETTING-STARTED/FILE-EXTENSIONS.html">
                                      File Extensions
                                  </a>
                              </li>
                                                </ul>
                    </li>
                                    <li>
                      <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i> Templates</a>
                      <ul>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/TEMPLATES/OVERVIEW.html">
                                      Installation
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/TEMPLATES/INHERITANCE.html">
                                      Template Inheritance
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/TEMPLATES/PARTIALS.html">
                                      Partials
                                  </a>
                              </li>
                                                </ul>
                    </li>
                                    <li>
                      <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i> Data</a>
                      <ul>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/DATA/PASS-DATA.html">
                                      Pass Data To Templates
                                  </a>
                              </li>
                                                        <li class="active">
                                  <a href="http://www.foilphp.it/docs/DATA/CONTEXT-API.html">
                                      Context API
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/DATA/RETRIEVE-DATA.html">
                                      Retrieve Data Inside Templates
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/DATA/HELPERS.html">
                                      Data Helpers
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/DATA/FILTERS.html">
                                      Data Filters
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/DATA/ARRAIZATION.html">
                                      Arraization
                                  </a>
                              </li>
                                                </ul>
                    </li>
                                    <li>
                      <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i> Functions</a>
                      <ul>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/FUNCTIONS/LOOP-HELPERS.html">
                                      Loop Helpers
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/FUNCTIONS/ARRAY-HELPERS.html">
                                      Array Helpers
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/FUNCTIONS/LINK-HELPERS.html">
                                      Link Helpers
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/FUNCTIONS/URI-HELPERS.html">
                                      Uri Helpers
                                  </a>
                              </li>
                                                </ul>
                    </li>
                                    <li>
                      <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i> Extending Foil</a>
                      <ul>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/EXTENDING/FUNCTIONS-AND-FILTERS.html">
                                      Custom Functions and Filters
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/EXTENDING/CUSTOM-EXTENSIONS.html">
                                      Custom Foil Extensions
                                  </a>
                              </li>
                                                </ul>
                    </li>
                                    <li>
                      <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i> Integrate Foil</a>
                      <ul>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/INTEGRATE/OVERVIEW.html">
                                      Overview
                                  </a>
                              </li>
                                                        <li class="">
                                  <a href="http://www.foilphp.it/docs/INTEGRATE/API.html">
                                      API Functions
                                  </a>
                              </li>
                                                </ul>
                    </li>
                                        </ul>
      </div>
      <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div id="content" class="col-lg-11">
                                                <ol class="breadcrumb">
                          <li><a href="http://www.foilphp.it">Foil</a></li>
                          <li class="active">Data</li>
                        </ol>
                                                <!--
currentMenu: "contextapi"
currentSection: "Data"
title: "Context API"
-->
<h1>Context API</h1>
<p>Pass data to Foil engine <code>render()</code> method is the simplest and preferred way to pass data to templates.</p>
<p>However, often one needs to pass some data to <em>any</em> template rendered or to <em>some</em> templates under specific conditions.
For example, if you want to pass the current user object to any template on a backend system.</p>
<p>Foil context API is just a way to pass data to any template or groups of templates without having to pass that data to <code>render()</code> engine method.</p>
<p>There are two ways to use Foil context API:</p>
<ul>
<li>via engine methods <code>useData()</code> and <code>useContext()</code></li>
<li>via Foil API</li>
</ul>
<p>The latter is a simple but powerful tool to use <strong>all</strong> Foil features (so not only context API) and facilitate the integration of Foil in any application.
It is documented in <em>"Integrate Foil / API"</em> docs section.</p>
<h2><code>useData()</code></h2>
<p>This engine method accepts an array of data, that will be available in <strong>all</strong> templates.</p>
<pre><code class="language-php">$engine-&gt;useData(['app_name' =&gt; 'My Awesome App']);</code></pre>
<p>Using code above, any template that is rendered using that engine object will have access to <code>'app_name'</code> variable.</p>
<p>Note that in case of name conflict between data assigned via context API and data directly passed to template, the latter takes precedence:</p>
<pre><code class="language-php">$engine-&gt;render('a-template', ['app_name' =&gt; 'My Super Awesome App']);</code></pre>
<p>Using code above, in the <code>a-template.php</code> template, <code>'app_name'</code> variable will be equal to <em>'My Super Awesome App'</em>.</p>
<h2><code>useContext()</code></h2>
<p>This method is used to pass some data to a set of templates. Templates to pass data to can be selected in 2 ways:</p>
<ul>
<li>all templates whose file path contain a string or matches a regex</li>
<li>using a custom context class</li>
</ul>
<p>To match all templates whose file path contain a string you need to pass the string to search as 1st argument to <code>useContext()</code> and the data to pass as 2nd argument.</p>
<p>For example:</p>
<pre><code class="language-php">$engine-&gt;useContext('/admin/', ['owner' =&gt; get_current_user()]);</code></pre>
<p>Using code above all templates whose path contain the string <code>"/admin/"</code> will have access to the <code>'owner'</code> variable.</p>
<p>If you pass <code>true</code> as 3rd argument the string search is done using regex:</p>
<pre><code class="language-php">$engine-&gt;useContext('/\.phtml$/', ['foo' =&gt; 'Bar'], true);</code></pre>
<p>Using code above all templates whose extension is <code>.phtml</code> will have access to <code>'foo'</code> variable.</p>
<h2>Custom Context Objects</h2>
<p>A possible issue with code above is that the code used to retrieve the data that is passed as 2nd argument to <code>useContext()</code> is always ran,
even if the template that is rendered doesn't satisfy the condition (so will not receive that data).</p>
<p>This is non-issue if data passed is hardcoded, e.g. like in the <code>['foo' =&gt; 'Bar']</code> example above, but if data needs to be retrieved using <em>expensive</em> code, makes no sense
run it if the template will not satisfy the condition.</p>
<p>To overcome this problem is possible to write custom context classes. They are classes that extends <code>Foil\Contracts\ContextInterface</code>.</p>
<p>That interface has just 2 methods:</p>
<ul>
<li><code>accept($template)</code></li>
<li><code>provide()</code></li>
</ul>
<p><code>accept()</code> receives the template path that is going to be rendered, if it returns <code>true</code> all data returned by <code>provide()</code> (that must be an array) is passed to template.</p>
<p>Let's see an usage example:</p>
<pre><code class="language-php">namespace MyApp;

use Foil\Contracts\ContextInterface;

class BlogMenuContext implements ContextInterface
{
    private $menu;

    public function __construct(MenuModel $menu)
    {
        $this-&gt;menu = $menu;
    }

    public function accept($template)
    {
        return strstr($template, DIRECTORY_SEPARATOR.'blog') !== false;
    }

    public function provide()
    {
        return ['menu' =&gt; $this-&gt;menu-&gt;getItems()];
    }
}</code></pre>
<p>The <code>accept()</code> method in class above receives template path and return true only if it contains <em>"/blog"</em>.</p>
<p><strong>Only in that case</strong> <code>provide()</code> method runs and, using menu model, gets menu items that are passed to template in <code>'menu'</code> variable.</p>
<p>If this class is available, it can be used passing an instance of it to <code>useContext()</code> engine method:</p>
<pre><code class="language-php">$engine-&gt;useContext(new BlogMenuContext());</code></pre>
<p>You can think at context classes as a sort of <em>inverted controllers</em>: normally controllers pass data to views based on external conditions (e.g. which route matched),
when using context classes are the views that <em>claims</em> data.</p>
<p>This approach makes a lot of sense for view-specific data that there is no reason a controller is aware of.
For example, why a controller should be aware which styles or scripts a template uses?</p>
<p>A similar approach is used in <a href="http://laravel.com/docs/4.2/responses#view-composers">Laravel View Composers</a>, but Foil context API is more flexible because</p>
<ul>
<li>is framework agnostic</li>
<li>context classes are not aware of view object, so is possible to use any kind of view object or no view object at all</li>
<li>how to match a template is left to user, where in Lavarel is only possible to exactly match a template name or a set of template names</li>
</ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- /#page-content-wrapper -->

                    <a href="https://github.com/Giuseppe-Mazzapica/Foil">
                <img style="position:fixed; top:0; right:0; border:0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
            </a>
                <a href="#" id="menu-toggle" title="Toggle Menu"><i class="fa fa-bars"></i></a>


    </div>
    <!-- /#wrapper -->

    <footer class="footer hidden-xs hidden-sm">
      Made by hands by
      <a href="http://gm.zoomlab.it/" title="Giuseppe Mazzapica Home Page" target="_blank">Giuseppe Mazzapica</a>, with
      <a href="http://couscous.io/" title="Couscous" target="_blank">Couscous</a>,
      <a href="http://getbootstrap.com/" title="Bootstrap" target="_blank">Bootstrap</a> &amp;
      <a href="https://highlightjs.org/" title="highlight.js" target="_blank">highlight.js</a>

      <span class="socials">
        <a href="https://github.com/Giuseppe-Mazzapica" title="GitHub" target="_blank"><i class="fa fa-github-alt"></i></a>
        <a href="https://twitter.com/gmazzap" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a>
        <a href="http://wordpress.stackexchange.com/users/35541/" title="Stack Exchange" target="_blank"><i class="fa fa-stack-exchange"></i></a>
      </span>

    </footer>

    <a href="#wrapper" class="hidden-xs hidden-sm" id="back-top" title="Back to top"><i class="fa fa-long-arrow-up"></i></a>
    <script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>
    <script src="http://www.foilphp.it/js/theme.min.js"></script>


</body>

</html>
